import java.util.*;


// User Login Menu - Uses HashMap

class AccountVerifier {
    private Map<String, String> accounts = new HashMap<>();

    public void register() {
        Scanner scanner = new Scanner(System.in);

        System.out.println("\n=== Registration ===");
        System.out.print("Enter a username: ");
        String username = scanner.nextLine().trim();

        if (accounts.containsKey(username)) {
            System.out.println("Username already exists! Please choose another.");
            return;
        }

        System.out.print("Enter a password: ");
        String password = scanner.nextLine().trim();

        accounts.put(username, password);
        System.out.println("Registration successful for user: " + username);
    }

    public boolean login() {
        Scanner scanner = new Scanner(System.in);

        System.out.println("\n========== Login ==========");
        System.out.print("Enter your Username: ");
        String enteredUsername = scanner.nextLine();

        System.out.print("Enter your Password: ");
        String enteredPassword = scanner.nextLine();

        if (accounts.containsKey(enteredUsername) &&
            accounts.get(enteredUsername).equals(enteredPassword)) {
            System.out.println("Login successful! Welcome " + enteredUsername);
            return true;
        } else {
            System.out.println("Incorrect Username or Password!");
            return false;
        }
    }
}

  
  
// Error-handling: Checking for invalid inputs

class InputHelper {
    public static int safeIntInput(Scanner sc, int min, int max) {
        while (true) {
            try {
                int num = Integer.parseInt(sc.nextLine());
                if (num < min || num > max) {
                    System.out.println("Invalid choice! Enter a number between " + min + " and " + max + ".");
                    continue;
                }
                return num;
            } catch (NumberFormatException e) {
                System.out.println("ERROR: Enter numbers only!");
            }
        }
    }
}



// Member Management - Uses Linked List

class Member {
    String name;
    Member next;

    public Member(String name) {
        this.name = name;
    }
}

class MemberList {
    private Member head;

    public void insert(String name, int index) {
        Member newNode = new Member(name);
        if (index == 0 || head == null) {
            newNode.next = head;
            head = newNode;
            return;
        }
        Member temp = head;
        int i = 0;
        while (temp.next != null && i < index - 1) {
            temp = temp.next;
            i++;
        }
        newNode.next = temp.next;
        temp.next = newNode;
    }

    public boolean remove(String name) {
        if (head == null) return false;
        if (head.name.equalsIgnoreCase(name)) {
            head = head.next;
            return true;
        }

        Member temp = head;
        while (temp.next != null) {
            if (temp.next.name.equalsIgnoreCase(name)) {
                temp.next = temp.next.next;
                return true;
            }
            temp = temp.next;
        }
        return false;
    }

    public boolean search(String name) {
        Member temp = head;
        while (temp != null) {
            if (temp.name.equalsIgnoreCase(name)) return true;
            temp = temp.next;
        }
        return false;
    }

    public void sort() {
        if (head == null) return;
        for (Member i = head; i != null; i = i.next) {
            for (Member j = i.next; j != null; j = j.next) {
                if (i.name.compareToIgnoreCase(j.name) > 0) {
                    String t = i.name;
                    i.name = j.name;
                    j.name = t;
                }
            }
        }
    }

    public int count() {
        int c = 0;
        Member temp = head;
        while (temp != null) {
            c++;
            temp = temp.next;
        }
        return c;
    }

    public void display() {
        System.out.println("\n--- Registered Member ---");
        Member temp = head;
        while (temp != null) {
            System.out.println("- " + temp.name);
            temp = temp.next;
        }
        System.out.println("Total: " + count());
    }
}



// Undo Operations - Uses Stack

class UndoAction {
    String description;
    Runnable undo;

    UndoAction(String description, Runnable undo) {
        this.description = description;
        this.undo = undo;
    }
}

class UndoStack {
    private Stack<UndoAction> stack = new Stack<>();

    public void push(UndoAction action) {
        stack.push(action);
    }

    public void undoLast() {
        if (stack.isEmpty()) {
            System.out.println("Nothing to undo.");
            return;
        }
        UndoAction act = stack.pop();
        act.undo.run();
        System.out.println("Undone: " + act.description);
    }

    public void display() {
        System.out.println("\n--- Undo History ---");
        if (stack.isEmpty()) {
            System.out.println("(empty)");
            return;
        }
        for (UndoAction a : stack) {
            System.out.println("- " + a.description);
        }
    }
}



// To-do List - Uses Queue

class Task {
    String description;
    int priority;
    public Task(String description, int priority) {
        this.description = description;
        this.priority = priority;
    }
    public String toString() {
        return description + " (P:" + priority + ")";
    }
}

class TaskQueue {
    private PriorityQueue<Task> queue =
        new PriorityQueue<>((a, b) -> b.priority - a.priority);

    public void addTask(Task t) {
        queue.add(t);
    }

    public Task serve() {
        return queue.poll();
    }

    public Task peek() {
        return queue.peek();
    }

    public void display() {
        System.out.println("\n--- Pending Tasks ---");
        if (queue.isEmpty()) {
            System.out.println("(none)");
            return;
        }
        for (Task t : queue) {
            System.out.println("- " + t);
        }
    }
}



// Course Load - Uses ArrayList

class ProjectsCatalog {
    private ArrayList<String> projects = new ArrayList<>();

    public void addCourse(String s) {
        projects.add(s);
    }

    public boolean upgradeCourse(String oldName, String newName) {
        int i = projects.indexOf(oldName);
        if (i != -1) {
            projects.set(i, newName);
            return true;
        }
        return false;
    }

    public boolean removeCourse(String s) {
        return projects.remove(s);
    }

    public boolean search(String s) {
        return projects.contains(s);
    }

    public void sort() {
        Collections.sort(projects);
    }

    public void display() {
        System.out.println("\n--- Course Load ---");
        for (String s : projects) {
            System.out.println("- " + s);
        }
        System.out.println("Total: " + projects.size());
    }
}



// Submenus Options and Actions

class MenuHandlers {

    public static void manageMember(Scanner sc, MemberList member, UndoStack undo) {
        while (true) {
            System.out.println("\n----- TEAM MEMBERS -----");
            System.out.println("1. Add Member");
            System.out.println("2. Remove Member");
            System.out.println("3. Search");
            System.out.println("4. Sort");
            System.out.println("5. Display All");
            System.out.println("6. Return to Main Menu");
            System.out.println("Choose Option: ");

            int p = InputHelper.safeIntInput(sc, 1, 6);

            switch (p) {
                case 1:
                    System.out.print("Enter name: ");
                    String name = sc.nextLine();
                    System.out.print("Enter index number: ");
                    int idx = InputHelper.safeIntInput(sc, 0, 999);

                    member.insert(name, idx);
                    undo.push(new UndoAction("Add Member " + name,
                            () -> member.remove(name)));
                    break;

                case 2:
                    System.out.print("Enter name: ");
                    name = sc.nextLine();
                    if (member.remove(name)) {
                        undo.push(new UndoAction("Remove Member " + name,
                                () -> member.insert(name, 0)));
                    } else {
                        System.out.println("Name not found.");
                    }
                    break;

                case 3:
                    System.out.print("Search name: ");
                    name = sc.nextLine();
                    System.out.println(member.search(name) ? "Found." : "Not found.");
                    break;

                case 4:
                    member.sort();
                    System.out.println("Sorted.");
                    break;

                case 5:
                    member.display();
                    break;

                case 6:
                    return;
            }
        }
    }

    public static void manageTasks(Scanner sc, TaskQueue tasks, UndoStack undo) {
        while (true) {
            System.out.println("\n----- TO-DO LIST -----");
            System.out.println("1. Add Task");
            System.out.println("2. Finish Earliest Task");
            System.out.println("3. Check Earliest Task");
            System.out.println("4. Display All Tasks");
            System.out.println("5. Return to Main Menu");
            System.out.println("Choose Option: ");

            int t = InputHelper.safeIntInput(sc, 1, 5);

            switch (t) {
                case 1:
                    System.out.print("Description: ");
                    String d = sc.nextLine();
                    System.out.print("Priority (1-10): ");
                    int pr = InputHelper.safeIntInput(sc, 1, 10);

                    Task task = new Task(d, pr);
                    tasks.addTask(task);

                    undo.push(new UndoAction("Add Activity " + d,
                            () -> tasks.serve()));
                    break;

                case 2:
                    Task served = tasks.serve();
                    System.out.println(served == null ? "No activities available." : "Submitted: " + served);
                    break;

                case 3:
                    Task next = tasks.peek();
                    System.out.println(next == null ? "No activities." : "Pending: " + next);
                    break;

                case 4:
                    tasks.display();
                    break;

                case 5:
                    return;
            }
        }
    }

    public static void manageProjects(Scanner sc, ProjectsCatalog projects, UndoStack undo) {
        while (true) {
            System.out.println("\n----- PROJECTS -----");
            System.out.println("1. Add Project");
            System.out.println("2. Update Project");
            System.out.println("3. Remove Project");
            System.out.println("4. Search");
            System.out.println("5. Sort");
            System.out.println("6. Display Projects");
            System.out.println("7. Return to Main Menu");
            System.out.println("Choose Option: ");

            int s = InputHelper.safeIntInput(sc, 1, 7);

            switch (s) {
                case 1:
                    System.out.print("Course name: ");
                    String name = sc.nextLine();
                    projects.addCourse(name);
                    undo.push(new UndoAction("Add Course " + name,
                            () -> projects.removeCourse(name)));
                    break;

                case 2:
                    System.out.print("Old name: ");
                    String oldN = sc.nextLine();
                    System.out.print("New name: ");
                    String newN = sc.nextLine();
                    if (projects.upgradeCourse(oldN, newN)) {
                        undo.push(new UndoAction("Update Course " + oldN,
                                () -> projects.upgradeCourse(newN, oldN)));
                    } else {
                        System.out.println("Course not found.");
                    }
                    break;

                case 3:
                    System.out.print("Name: ");
                    name = sc.nextLine();
                    if (projects.removeCourse(name)) {
                        undo.push(new UndoAction("Remove Course " + name,
                                () -> projects.addCourse(name)));
                    } else {
                        System.out.println("Course not found.");
                    }
                    break;

                case 4:
                    System.out.print("Search: ");
                    name = sc.nextLine();
                    System.out.println(projects.search(name) ? "Found." : "Not found.");
                    break;

                case 5:
                    projects.sort();
                    System.out.println("Sorted.");
                    break;

                case 6:
                    projects.display();
                    break;

                case 7:
                    return;
            }
        }
    }

    public static void manageUndo(Scanner sc, UndoStack undo) {
        while (true) {
            System.out.println("\n----- CHANGE LOG -----");
            System.out.println("1. Undo Recent");
            System.out.println("2. View Undo History");
            System.out.println("3. Return to Main Menu");
            System.out.println("Choose Option: ");

            int u = InputHelper.safeIntInput(sc, 1, 3);

            switch (u) {
                case 1:
                    undo.undoLast();
                    break;
                case 2:
                    undo.display();
                    break;
                case 3:
                    return;
            }
        }
    }
}



// Main Program

public class Main {
    public static void main(String[] args) {

        Scanner sc = new Scanner(System.in);
        MemberList member = new MemberList();
        TaskQueue tasks = new TaskQueue();
        ProjectsCatalog projects = new ProjectsCatalog();
        UndoStack undo = new UndoStack();
        AccountVerifier auth = new AccountVerifier();

        boolean authenticated = false;


while (true) {  


    // User Login

    while (!authenticated) {
        System.out.println("\n============ USER LOGIN MENU ============");
        System.out.println("1. Register");
        System.out.println("2. Login");
        System.out.println("3. Exit Program");
        System.out.println("Choose Option: ");

        int opt = InputHelper.safeIntInput(sc, 1, 3);

        switch (opt) {
            case 1:
                auth.register();
                break;
            case 2:
                authenticated = auth.login();
                break;
            case 3:
                System.out.println("Exiting...");
                return;
        }
    }



    // MAIN MENU PHASE

    while (authenticated) {
        System.out.println("\n---------------------------------------------------");
        System.out.println("------------PROJECT MANAGEMENT SYSTEM------------");
        System.out.println("---------------------------------------------------");
        System.out.println("1. Manage Team Member");
        System.out.println("2. Projects");
        System.out.println("3. Task Queue");
        System.out.println("4. Change Log");
        System.out.println("5. Logout");
        System.out.println("6. Exit Program");
        System.out.println("Choose Option: ");

        int choice = InputHelper.safeIntInput(sc, 1, 6);

        switch (choice) {
            case 1: MenuHandlers.manageMember(sc, member, undo); break;
            case 2: MenuHandlers.manageTasks(sc, tasks, undo); break;
            case 3: MenuHandlers.manageProjects(sc, projects, undo); break;
            case 4: MenuHandlers.manageUndo(sc, undo); break;

            case 5:
                System.out.println("You have been logged out.");
                authenticated = false;   
                break;

            case 6:
                System.out.println("Goodbye!");
                return;
                }
            }
        }
    }
}





